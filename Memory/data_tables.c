/* Data_tables.c
*
* Just some test code for EPROM and FLASH r/w routines
*
* Define the default ECU configuration aka 'the base map'
* We could use EPROM or FLASH memory but EPROM can be updated 'live' if we use re-entrant code
* define data areas in the project properties in Atmel Studio or in the linker file
*
* ATMega2560 EEPROM is 4k
* J Holland
* 4th January 2021
* v0.1
*/


#include <stdint.h>
#include "avr/eeprom.h"
#include "data_tables.h"




/************************************ Place in EPMPROM *****************************************/

/* Data ID = StxTest_data_V1  ETX */
uint8_t EEM_DATA_ID_STR[16] EEMEM = { 0x02, 0x54, 0x65, 0x73, 0x74, 0x5F, 0x64, 0x61, 0x74, 0x61, 0x5F, 0x56, 0x31, 0x20, 0x20, 0x03 };

uint8_t EEM_CTS_VLimits[2] EEMEM = { 0x10, 0xF0 }; 			/* voltage limits for diagnostics */
		
uint8_t EEM_CTS_Default[1] EEMEM = { 0x40 };					   /* default if sensor fault detected */

uint8_t EEM_CTS_Index[16] EEMEM = { 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 };
		
uint8_t EEM_ColdStartFuel [16] EEMEM = { 0xFF, 0xFF, 0xFF, 0x80, 0x50, 0x40, 0x18, 0x14, 0x10, 0x0B, 0x07, 0x07, 0x07, 0x07, 0x08, 0x08 };
		
uint8_t EEM_CTSCompFuel [16] EEMEM = { 0x9C, 0x90, 0x45, 0x30, 0x20, 0x15, 0x06, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x04 };
		
uint8_t EEM_CTSAccEnrich1 [16] EEMEM = { 0x9C, 0x90, 0x45, 0x30, 0x20, 0x15, 0x06, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x04 };
		
uint8_t EEM_CTSAccEnrich2 [16] EEMEM = { 0x9C, 0x90, 0x45, 0x30, 0x20, 0x15, 0x06, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x04 };
		
uint8_t EEM_CTSAccEnrich3 [16] EEMEM = { 0x9C, 0x90, 0x45, 0x30, 0x20, 0x15, 0x06, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x04 };
		
	/* VE table */
 uint8_t EEM_Base_Ign_LUT[16][16] EEMEM = { 
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 }
	};



/******************************* Place in FLASH ***********************************************/


/* IAT  tables - random data */
uint8_t IAT_VLimits[2] __attribute__ ((section (".FLASH_DATA"))) = 
	{ 0x10, 0xF0 }; 	/* voltage limits for diagnostics */
		
uint8_t IAT_Default __attribute__ ((section (".FLASH_DATA")))	= 
	0x40;					/* default if sensor fault detected */

uint8_t IAT_Index[16] __attribute__ ((section (".FLASH_DATA"))) = 
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 };

/* Voltage correction tables - random data */
uint8_t InjDeadTime_LUT[16] __attribute__ ((section (".FLASH_DATA"))) = 
	{ 0xFF, 0xFF, 0xFF, 0x80, 0x50, 0x40, 0x18, 0x14, 0x10, 0x0B, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00 };
		
uint8_t IgnDwell_LUT[16] __attribute__ ((section (".FLASH_DATA"))) = 
	{ 0xFF, 0xFF, 0xFF, 0x80, 0x50, 0x40, 0x18, 0x14, 0x10, 0x0B, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00 };

/* VE table */
uint8_t VE_LUT[16][16] __attribute__ ((section (".FLASH_DATA"))) = {
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 }
	};

/* AFR table */
uint8_t AFR_LUT[16][16] __attribute__ ((section (".FLASH_DATA"))) = { 
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 },
	{ 0x1A, 0x1D, 0x22, 0x2A, 0x35, 0x44, 0x56, 0x6A, 0x7F, 0x93, 0xA6, 0xB6, 0xC4, 0xCF, 0xD8, 0xE0 }
	};


void initDataMemory(void)
{
	/* we have to make the memory visible to other files through the header so lets assign pointers to the memory sections 
		thus appears to be enough to create the .epp file even if this routine is not called. */
	
	DATA_ID_STR = EEM_DATA_ID_STR;
	
	CTS_VLimits = EEM_CTS_VLimits;
	CTS_Default = EEM_CTS_Default;
	CTS_Index = EEM_CTS_Index;
	ColdStartFuel = EEM_ColdStartFuel;
	CTSCompFuel = EEM_CTSCompFuel;
	CTSAccEnrich1 = EEM_CTSAccEnrich1;
	CTSAccEnrich2 = EEM_CTSAccEnrich2;
	CTSAccEnrich3 = EEM_CTSAccEnrich3;
	Base_Ign_LUT = EEM_Base_Ign_LUT;

	
	
}

